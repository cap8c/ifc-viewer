<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFC Viewer</title>
    <style>
        body { margin: 0; display: flex; height: 100vh; overflow: hidden; }
        #myCanvas { width: 80%; height: 100%; }
        #myTreeViewContainer { width: 20%; height: 100%; overflow-y: auto; background-color: #f0f0f0; }
    </style>
</head>
<body>
    <div id="myTreeViewContainer"></div>
    <canvas id="myCanvas"></canvas>

    <script type="module">
        import { Viewer, WebIFCLoaderPlugin, TreeViewPlugin } from "https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/xeokit-sdk.es.min.js";
        import * as WebIFC from "https://cdn.jsdelivr.net/npm/web-ifc@0.0.51/web-ifc-api.js";

        // Initialize the viewer
        const viewer = new Viewer({
            canvasId: "myCanvas",
            transparent: true
        });

        // Set the camera position
        viewer.camera.eye = [-2.56, 8.38, 8.27];
        viewer.camera.look = [13.44, 3.31, -14.83];
        viewer.camera.up = [0.10, 0.98, -0.14];

        // Initialize the tree view plugin
        const treeView = new TreeViewPlugin(viewer, {
            containerElement: document.getElementById("myTreeViewContainer")
        });

        // Initialize the IFC API and loader
        const ifcAPI = new WebIFC.IfcAPI();
        ifcAPI.SetWasmPath("https://cdn.jsdelivr.net/npm/web-ifc@0.0.51/");

        ifcAPI.Init().then(() => {
            const ifcLoader = new WebIFCLoaderPlugin(viewer, { WebIFC, IfcAPI: ifcAPI });

            const model = ifcLoader.load({
                id: "myModel",
                src: "RST_basic_sample_project.ifc", // Path to the IFC file
                edges: true
            });

            model.on("loaded", () => {
                console.log("IFC model loaded successfully");
                viewer.scene.cameraFlight.flyTo(model);
                treeView.build(model); // Build the tree view from the model
            });

            model.on("error", (error) => {
                console.error("Error loading IFC model:", error);
            });
        }).catch(error => console.error("Error initializing IFC API:", error));
    </script>
</body>
</html>
